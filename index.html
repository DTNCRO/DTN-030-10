<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HPLC 기기 관리</title>
    
    <!-- React 및 라이브러리 로드 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .form-input, .form-select { width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: white; }
        .form-input:focus, .form-select:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 0 2px #bfdbfe; }
        .animate-fade-in-down { animation: fade-in-down 0.3s ease-out; }
        @keyframes fade-in-down { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 기본 설정 데이터 (초기값) ---
        const DEFAULT_DATA = {
            deviceName: "DTN-030-6",
            modelName: "Sciex",
            status: "정상 가동 중",
            serialNo: "DE12345678",
            acquisitionDate: "2022-01-10",
            lastInspectionDate: "2024-03-15",
            nextInspectionDate: "2025-03-15",
            intervalDays: 365, // 점검 주기
            contactPerson: "김담당",
            contactPhone: "010-1234-5678",
            contactEmail: "kim.manager@lab.com",
            // ▼ 링크는 여기서 수정하세요 ▼
            links: {
                sopLink: "#",      
                manualPdf: "#",    
                logExcel: "#",     
                troubleshoot: "#", 
                partsInfo: "#"     
            }
        };

        const App = () => {
            // 상태 관리 (브라우저 저장소 사용)
            const [deviceData, setDeviceData] = useState(() => {
                const saved = localStorage.getItem('hplc_data');
                return saved ? JSON.parse(saved) : DEFAULT_DATA;
            });
            
            const [isEditMode, setIsEditMode] = useState(false);
            const [showContactModal, setShowContactModal] = useState(false);
            const [message, setMessage] = useState(null);
            
            // 수정용 임시 데이터
            const [tempData, setTempData] = useState(deviceData);

            // 데이터 변경 시 자동 저장
            useEffect(() => {
                localStorage.setItem('hplc_data', JSON.stringify(deviceData));
            }, [deviceData]);

            // 날짜 계산 함수
            const calculateDDay = (dateString) => {
                if (!dateString) return null;
                const target = new Date(dateString);
                target.setHours(0,0,0,0);
                const today = new Date();
                today.setHours(0,0,0,0);
                return Math.ceil((target - today) / (1000 * 60 * 60 * 24));
            };

            const dDay = calculateDDay(deviceData.nextInspectionDate);
            const dDayText = dDay === null ? '미정' : dDay > 0 ? `D-${dDay}` : dDay === 0 ? 'D-DAY' : `D+${Math.abs(dDay)}`;
            
            const statusColor = {
                '수리중': 'bg-red-500/90',
                '점검중': 'bg-yellow-500/90',
                '사용중': 'bg-blue-500/90',
                '정상 가동 중': 'bg-blue-500/90'
            }[deviceData.status] || 'bg-white/20';
            
            const dDayColor = dDay === null || dDay > 7 ? 'text-green-600 bg-green-100' : (dDay > 0 ? 'text-yellow-600 bg-yellow-100' : 'text-red-600 bg-red-100');

            // 관리자 모드 토글
            const toggleEditMode = () => {
                if (!isEditMode) setTempData(deviceData);
                setIsEditMode(!isEditMode);
                setMessage(null);
            };

            // [기능 1] 점검 기록 저장
            const handleLogInspection = () => {
                const today = new Date();
                const newLast = today.toISOString().split('T')[0];
                
                const nextDate = new Date(today);
                nextDate.setDate(today.getDate() + parseInt(deviceData.intervalDays));
                const newNext = nextDate.toISOString().split('T')[0];

                setDeviceData(prev => ({
                    ...prev,
                    lastInspectionDate: newLast,
                    nextInspectionDate: newNext
                }));

                setMessage(`✅ 점검 완료! 다음 점검일: ${newNext}`);
                setTimeout(() => setMessage(null), 3000);
            };

            // [기능 2] 전체 정보 수정 저장
            const handleUpdateInfo = () => {
                // 날짜 자동 계산 (주기가 바뀌었을 수 있으므로)
                const lastDate = new Date(deviceData.lastInspectionDate);
                const nextDate = new Date(lastDate);
                nextDate.setDate(lastDate.getDate() + parseInt(tempData.intervalDays));
                
                setDeviceData({
                    ...tempData,
                    nextInspectionDate: nextDate.toISOString().split('T')[0]
                });
                
                setMessage("✅ 정보가 저장되었습니다.");
                setTimeout(() => setMessage(null), 3000);
                setIsEditMode(false);
            };

            // 입력값 변경 핸들러
            const handleChange = (field, value) => {
                setTempData(prev => ({ ...prev, [field]: value }));
            };
            
            const handleLinkChange = (field, value) => {
                setTempData(prev => ({ ...prev, links: { ...prev.links, [field]: value } }));
            };

            return (
                <div className="min-h-screen bg-gray-100 p-4 font-sans">
                    <div className="max-w-md mx-auto bg-white rounded-[30px] shadow-2xl overflow-hidden border border-gray-100 min-h-[800px] mt-5 mb-10">
                        
                        {/* Header */}
                        <div className="bg-gradient-to-br from-blue-600 to-cyan-500 p-8 text-white rounded-b-[40px] shadow-lg relative z-10">
                            <div className="text-center">
                                <div className={`inline-flex items-center ${statusColor} px-4 py-1.5 rounded-full mb-3 backdrop-blur-md shadow-sm border border-white/20`}>
                                    <div className={`w-2 h-2 rounded-full mr-2 ${deviceData.status === '정상 가동 중' ? 'bg-green-400' : 'bg-yellow-400'} animate-pulse`}></div>
                                    <span className="text-xs font-bold tracking-wide">{deviceData.status}</span>
                                </div>
                                <h1 className="text-3xl font-extrabold tracking-tight mb-1">{deviceData.deviceName}</h1>
                                <p className="text-sm text-blue-50 font-medium opacity-90">{deviceData.modelName}</p>
                            </div>
                        </div>

                        <div className="px-6 -mt-6 relative z-20 space-y-6 pb-10">
                            
                            {/* SOP Link Card */}
                            <a href={deviceData.links.sopLink} target="_blank" className="block bg-white p-4 rounded-2xl shadow-md border border-yellow-100 flex items-center justify-between hover:shadow-lg transition transform active:scale-[0.98]">
                                <div className="flex items-center">
                                    <div className="w-12 h-12 bg-yellow-50 text-yellow-600 rounded-xl flex items-center justify-center text-xl mr-4">
                                        <i className="fa-solid fa-link"></i>
                                    </div>
                                    <div>
                                        <p className="text-xs font-bold text-yellow-600 uppercase tracking-wider">LINK</p>
                                        <p className="font-bold text-gray-800 text-lg">SOP 접속 링크</p>
                                    </div>
                                </div>
                                <div className="w-8 h-8 bg-gray-50 rounded-full flex items-center justify-center text-gray-400"><i className="fa-solid fa-arrow-right"></i></div>
                            </a>

                            {/* 4-Tab Menu Grid */}
                            <div className="grid grid-cols-2 gap-4">
                                {[
                                    { title: "기기 매뉴얼", icon: "fa-book", color: "text-blue-600", bg: "bg-blue-50", link: deviceData.links.manualPdf },
                                    { title: "기기이력", icon: "fa-clock-rotate-left", color: "text-green-600", bg: "bg-green-50", link: deviceData.links.logExcel },
                                    { title: "고장 시 접수", icon: "fa-triangle-exclamation", color: "text-orange-500", bg: "bg-orange-50", link: deviceData.links.troubleshoot },
                                    { title: "부품 보유 현황 및 정보", icon: "fa-boxes-stacked", color: "text-purple-600", bg: "bg-purple-50", link: deviceData.links.partsInfo }
                                ].map((item, idx) => (
                                    <a key={idx} href={item.link} target="_blank" className="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition flex flex-col items-center text-center justify-center h-32">
                                        <div className={`w-12 h-12 ${item.bg} ${item.color} rounded-xl flex items-center justify-center text-2xl mb-3`}>
                                            <i className={`fa-solid ${item.icon}`}></i>
                                        </div>
                                        <span className="font-bold text-gray-800 text-sm leading-tight">{item.title}</span>
                                    </a>
                                ))}
                            </div>

                            {/* Inspection Info */}
                            <div className="bg-white rounded-2xl p-5 shadow-sm border border-gray-100">
                                <div className="flex justify-between items-center mb-4 pb-4 border-b border-gray-50">
                                    <h3 className="font-bold text-gray-800 flex items-center">
                                        <i className="fa-solid fa-calendar-day text-blue-500 mr-2"></i> 점검 일정
                                    </h3>
                                    <span className={`px-3 py-1 rounded-full text-xs font-extrabold ${dDayColor}`}>{dDayText}</span>
                                </div>
                                <div className="flex justify-between text-sm">
                                    <div className="text-center w-1/2 border-r border-gray-100">
                                        <p className="text-xs text-gray-400 mb-1">최근 점검일</p>
                                        <p className="font-semibold text-gray-700">{deviceData.lastInspectionDate}</p>
                                    </div>
                                    <div className="text-center w-1/2">
                                        <p className="text-xs text-gray-400 mb-1">차기 점검일</p>
                                        <p className="font-bold text-blue-600">{deviceData.nextInspectionDate}</p>
                                    </div>
                                </div>
                                <div className="text-center mt-3"><span className="text-xs text-gray-400 bg-gray-50 px-2 py-1 rounded">주기: {deviceData.intervalDays}일</span></div>
                            </div>

                            {/* Device Info Card */}
                            <div className="bg-gray-50 rounded-2xl p-5 border border-gray-200/60">
                                <h3 className="font-bold text-gray-800 mb-3 text-sm flex items-center">
                                    <i className="fa-solid fa-circle-info text-gray-400 mr-2"></i> 기기 정보
                                </h3>
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span className="text-gray-500">Serial No.</span>
                                        <span className="font-medium text-gray-800 tracking-wider">{deviceData.serialNo}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-500">도입일자</span>
                                        <span className="font-medium text-gray-800">{deviceData.acquisitionDate}</span>
                                    </div>
                                </div>
                            </div>

                            {/* Contact Button */}
                            <button onClick={() => setShowContactModal(true)} className="w-full bg-gray-900 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-gray-800 transition flex items-center justify-center">
                                <i className="fa-solid fa-headset mr-2"></i> 기기 담당자 연결
                            </button>

                            {/* Admin Toggle */}
                            <div className="text-center pt-4">
                                <button onClick={toggleEditMode} className="text-xs text-gray-400 underline">
                                    {isEditMode ? '관리자 모드 닫기' : '관리자 설정'}
                                </button>
                            </div>

                            {/* Admin Panel */}
                            {isEditMode && (
                                <div className="bg-white border-2 border-blue-100 rounded-2xl p-5 shadow-xl animate-fade-in-down mb-10">
                                    <h3 className="font-bold text-blue-900 mb-4">⚙️ 관리자 설정</h3>
                                    {message && <div className="p-2 bg-green-100 text-green-800 rounded mb-2 text-xs font-bold">{message}</div>}
                                    
                                    <div className="space-y-4">
                                        <button onClick={handleLogInspection} className="w-full bg-blue-500 text-white py-2 rounded font-bold text-sm hover:bg-blue-600 transition">
                                            오늘 날짜로 점검 기록
                                        </button>
                                        <p className="text-xs text-gray-400 text-center -mt-2">다음 점검일이 {deviceData.intervalDays}일 후로 설정됩니다.</p>
                                        <hr />
                                        
                                        <div className="grid grid-cols-2 gap-2">
                                            <input className="form-input" value={tempData.deviceName} onChange={e=>handleChange('deviceName', e.target.value)} placeholder="기기명" />
                                            <select className="form-select" value={tempData.status} onChange={e=>handleChange('status', e.target.value)}>
                                                <option>정상 가동 중</option><option>수리중</option><option>점검중</option><option>사용중</option>
                                            </select>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <input className="form-input" value={tempData.modelName} onChange={e=>handleChange('modelName', e.target.value)} placeholder="모델명" />
                                            <div className="relative">
                                                <input type="number" className="form-input" value={tempData.intervalDays} onChange={e=>handleChange('intervalDays', e.target.value)} placeholder="점검 주기" />
                                                <span className="absolute right-3 top-3 text-xs text-gray-400">일</span>
                                            </div>
                                        </div>
                                        
                                        {/* 날짜 입력 필드 */}
                                        <div className="grid grid-cols-2 gap-2">
                                            <input type="text" className="form-input" value={tempData.serialNo} onChange={e=>handleChange('serialNo', e.target.value)} placeholder="시리얼 No." />
                                            <input type="date" className="form-input" value={tempData.acquisitionDate} onChange={e=>handleChange('acquisitionDate', e.target.value)} />
                                        </div>

                                        {/* 링크 수정 필드 */}
                                        <label className="block text-xs font-bold text-gray-500 uppercase">SOP 링크</label>
                                        <input className="form-input" value={tempData.links.sopLink} onChange={e=>handleLinkChange('sopLink', e.target.value)} placeholder="http://..." />

                                        {/* 담당자 정보 */}
                                        <label className="block text-xs font-bold text-gray-500 uppercase mt-2">담당자 정보</label>
                                        <input className="form-input" value={tempData.contactPerson} onChange={e=>handleChange('contactPerson', e.target.value)} placeholder="담당자 이름" />
                                        <div className="grid grid-cols-2 gap-2">
                                            <input className="form-input" value={tempData.contactPhone} onChange={e=>handleChange('contactPhone', e.target.value)} placeholder="연락처" />
                                            <input className="form-input" value={tempData.contactEmail} onChange={e=>handleChange('contactEmail', e.target.value)} placeholder="이메일" />
                                        </div>
                                        
                                        <button onClick={handleUpdateInfo} className="w-full bg-gray-800 text-white py-2 rounded font-bold text-sm hover:bg-gray-900 transition mt-2">
                                            전체 정보 저장
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Contact Modal */}
                        {showContactModal && (
                            <div className="fixed inset-0 bg-black/60 flex justify-center items-center z-50 p-4" onClick={() => setShowContactModal(false)}>
                                <div className="bg-white p-6 rounded-2xl w-full max-w-sm" onClick={e => e.stopPropagation()}>
                                    <h3 className="text-xl font-bold mb-4">기기 담당자</h3>
                                    <div className="space-y-3 text-gray-700">
                                        <p><strong>이름:</strong> {deviceData.contactPerson}</p>
                                        <p><strong>연락처:</strong> <a href={`tel:${deviceData.contactPhone}`} className="text-blue-500">{deviceData.contactPhone}</a></p>
                                        <p><strong>이메일:</strong> <a href={`mailto:${deviceData.contactEmail}`} className="text-blue-500">{deviceData.contactEmail}</a></p>
                                    </div>
                                    <button onClick={() => setShowContactModal(false)} className="mt-6 w-full py-2 bg-gray-900 text-white rounded-xl">닫기</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
